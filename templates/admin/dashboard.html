{% extends "base.html" %}

{% block title %}Admin Dashboard - VPN Service{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-4xl font-bold mb-2">
        <i class="fas fa-cog text-purple-400 mr-3"></i>Admin Dashboard
    </h1>
    <p class="text-gray-400">Manage users, plans, and subscriptions</p>
</div>

<!-- Tabs -->
<div class="mb-6 border-b border-gray-700">
    <div class="flex space-x-4">
        <button onclick="showTab('plans')" class="tab-button px-4 py-2 border-b-2 border-purple-500 font-semibold">
            <i class="fas fa-tags mr-2"></i>Plans
        </button>
        <button onclick="showTab('users')" class="tab-button px-4 py-2 border-b-2 border-transparent hover:border-gray-600">
            <i class="fas fa-users mr-2"></i>Users
        </button>
        <button onclick="showTab('subscriptions')" class="tab-button px-4 py-2 border-b-2 border-transparent hover:border-gray-600">
            <i class="fas fa-credit-card mr-2"></i>Subscriptions
        </button>
        <a href="{{ url_for('admin_payments') }}" class="px-4 py-2 border-b-2 border-transparent hover:border-gray-600">
            <i class="fas fa-money-check-alt mr-2"></i>Payments
        </a>
        <a href="{{ url_for('admin_servers') }}" class="px-4 py-2 border-b-2 border-transparent hover:border-gray-600">
            <i class="fas fa-server mr-2"></i>Servers
        </a>
    </div>
</div>

<!-- Plans Tab -->
<div id="plans-tab" class="tab-content">
    <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-6">
        <h2 class="text-2xl font-bold mb-4">Create New Plan</h2>
        <form method="POST" action="{{ url_for('admin_create_plan') }}" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <input type="text" name="name" placeholder="Plan Name" required
                   class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-blue-500">
            <input type="number" name="price" step="0.01" placeholder="Price" required
                   class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-blue-500">
            <input type="number" name="duration_days" placeholder="Duration (days)" required
                   class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-blue-500">
            <button type="submit" class="px-6 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold transition">
                <i class="fas fa-plus mr-2"></i>Create Plan
            </button>
        </form>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {% for plan in plans %}
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <h3 class="text-xl font-bold mb-2">{{ plan['name'] }}</h3>
            <p class="text-2xl font-bold text-blue-400 mb-4">${{ "%.2f"|format(plan['price']) }}</p>
            <p class="text-gray-400 mb-4">{{ plan['duration_days'] }} days</p>
            <form method="POST" action="{{ url_for('admin_update_plan', plan_id=plan['id']) }}" class="space-y-2 mb-2">
                <input type="text" name="name" value="{{ plan['name'] }}" required
                       class="w-full px-3 py-1 bg-gray-700 border border-gray-600 rounded text-sm">
                <input type="number" name="price" value="{{ plan['price'] }}" step="0.01" required
                       class="w-full px-3 py-1 bg-gray-700 border border-gray-600 rounded text-sm">
                <input type="number" name="duration_days" value="{{ plan['duration_days'] }}" required
                       class="w-full px-3 py-1 bg-gray-700 border border-gray-600 rounded text-sm">
                <button type="submit" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-sm transition">
                    <i class="fas fa-save mr-1"></i>Update
                </button>
            </form>
            <a href="{{ url_for('admin_delete_plan', plan_id=plan['id']) }}" 
               onclick="return confirm('Are you sure?')"
               class="block w-full px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-sm text-center transition">
                <i class="fas fa-trash mr-1"></i>Delete
            </a>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Users Tab -->
<div id="users-tab" class="tab-content hidden">
    <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 overflow-x-auto">
        <h2 class="text-2xl font-bold mb-4">All Users</h2>
        <table class="w-full">
            <thead>
                <tr class="border-b border-gray-700">
                    <th class="text-left py-3 px-4">Email</th>
                    <th class="text-left py-3 px-4">Status</th>
                    <th class="text-left py-3 px-4">Subscription</th>
                    <th class="text-left py-3 px-4">End Date</th>
                    <th class="text-left py-3 px-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr class="border-b border-gray-700 hover:bg-gray-700">
                    <td class="py-3 px-4">{{ user['email'] }}</td>
                    <td class="py-3 px-4">
                        {% if user['is_active'] %}
                        <span class="px-2 py-1 bg-green-600 rounded text-sm">Active</span>
                        {% else %}
                        <span class="px-2 py-1 bg-red-600 rounded text-sm">Disabled</span>
                        {% endif %}
                    </td>
                    <td class="py-3 px-4">{{ user['plan_name'] or 'None' }}</td>
                    <td class="py-3 px-4">{{ user['end_date'][:10] if user['end_date'] else '-' }}</td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <a href="{{ url_for('admin_toggle_user', user_id=user['id']) }}" 
                               class="px-3 py-1 bg-yellow-600 hover:bg-yellow-700 rounded text-sm transition">
                                <i class="fas fa-toggle-{{ 'on' if user['is_active'] else 'off' }}"></i>
                            </a>
                            <a href="{{ url_for('admin_generate_config', user_id=user['id']) }}" 
                               class="px-3 py-1 bg-purple-600 hover:bg-purple-700 rounded text-sm transition">
                                <i class="fas fa-key"></i>
                            </a>
                            <form method="POST" action="{{ url_for('admin_assign_subscription', user_id=user['id']) }}" class="inline">
                                <select name="plan_id" class="px-2 py-1 bg-gray-700 border border-gray-600 rounded text-sm mr-1">
                                    {% for plan in plans %}
                                    <option value="{{ plan['id'] }}">{{ plan['name'] }}</option>
                                    {% endfor %}
                                </select>
                                <button type="submit" class="px-3 py-1 bg-green-600 hover:bg-green-700 rounded text-sm transition">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Subscriptions Tab -->
<div id="subscriptions-tab" class="tab-content hidden">
    <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 overflow-x-auto">
        <h2 class="text-2xl font-bold mb-4">All Subscriptions</h2>
        <table class="w-full">
            <thead>
                <tr class="border-b border-gray-700">
                    <th class="text-left py-3 px-4">User</th>
                    <th class="text-left py-3 px-4">Plan</th>
                    <th class="text-left py-3 px-4">Start Date</th>
                    <th class="text-left py-3 px-4">End Date</th>
                    <th class="text-left py-3 px-4">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for sub in subscriptions %}
                <tr class="border-b border-gray-700 hover:bg-gray-700">
                    <td class="py-3 px-4">{{ sub['email'] }}</td>
                    <td class="py-3 px-4">{{ sub['plan_name'] }}</td>
                    <td class="py-3 px-4">{{ sub['start_date'][:10] }}</td>
                    <td class="py-3 px-4">{{ sub['end_date'][:10] }}</td>
                    <td class="py-3 px-4">
                        {% if sub['status'] == 'active' %}
                        <span class="px-2 py-1 bg-green-600 rounded text-sm">Active</span>
                        {% else %}
                        <span class="px-2 py-1 bg-red-600 rounded text-sm">Expired</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
    });
    
    // Remove active class from all buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('border-purple-500');
        btn.classList.add('border-transparent');
    });
    
    // Show selected tab
    document.getElementById(tabName + '-tab').classList.remove('hidden');
    
    // Activate button
    event.target.classList.remove('border-transparent');
    event.target.classList.add('border-purple-500');
}
</script>
{% endblock %}

